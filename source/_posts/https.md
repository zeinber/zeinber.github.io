---
title: 浅析 HTTPS
date: 2018-01-22 15:30:12
tags:
    - HTTPS
categories: 网络
---

一直对于 HTTPS 的概念理解的不透彻，与人探讨之时也会因为并没有完全弄懂而一时语塞。因此下定决心去搞懂这个概念。
HTTPS 是在 HTTP 与某一个协议的混合，这个协议一般指的是 TLS（更早的有 SSL ）。因为要先弄清楚什么是 HTTPS ，就得先弄清楚什么是 HTTP 。

<!--more-->

## HTTP

HTTP（HyperText Transport Protocol）是超文本传输协议的缩写，它用于传送 WWW 方式的数据。 HTTP 协议采用了请求/响应模型。客户端向服务器发送一个请求，请求头包含请求的方法、 URL 、协议版本、以及包含请求修饰符、客户信息和内容类似于 MIME 的消息结构。服务器以一个状态行作为响应，响应的内容包括消息协议的版本，成功或者错误编码加上包含服务器信息、实体元信息以及可能的实体内容。

简单的过程可以归纳成
+ DNS 解析，请求 DNS 服务器，获取域名对应的 IP 地址。
+ 与服务端建立连接，包括 tcp 三次握手，安全协议同步流程。
+ 连接建立完成，发送和接收数据，解码数据。

### HTTP 的隐患

HTTP 的一个简单的现实场景：
      假设你坐在一个教室里，你现在非常想把某个信息传递给教室里的另一个人，一般来说，会选择传纸条。传纸条这个比喻其实非常正确，这就是互联网的一个基础协议 TCP/IP 协议基本的工作模式。而通常，HTTP 协议的数据是使用 TCP/IP 协议进行发送的。HTTP 指的是你在纸条上写明你要传送的目的地是哪个同学的座位，然后再是要传递的内容。途径的同学拿到纸条后根据纸条上显示的地址依次传过去就好了。这样要面临的第一个问题就是：途经的同学可以完全知道你写了什么。
也就是说 HTTP 协议容易在传输数据过程中被人窃听，即在同一个网络下或者是途径的路由上的攻击者可以偷窥到你传输的内容。

### 解决方案

**对称加密**

既然容易在传输过程中被窃听，那么很容易想到的办法就是给数据进行加密。最简单的办法就是双方约定一个暗号，进行加密。为了让接收端能解析发送端发送的数据，一般会采用对称加密的算法，如 AES 。这种算法一般会有个秘钥，用于对数据进行加密，接收到后对数据进行解密，完成通信。但是这里存在一个问题，这种算法存在密钥 key ，如果放在传输的数据中，就容易在传输的过程中被人拿来进行数据解密，依旧无法保障数据安全。

**非对称加密**

为了保证 key 只要发送方和接收方知道。于是就想到了另一类加密算法-非对称算法，如 RSA 。这种加密方式一般是生成一对密钥 (k1, k2)。凡是 k1 加密的数据， k1 自身不能解密，而需要 k2 才能解密；凡是 k2 加密的数据，k2 不能解密，需要 k1 才能解密。于是数据就可以这样传输：用 RSA 技术生成了一对 k1、k2，你把 k1 用明文发送了出去，路经有人或许会截取，但是没有用，k1 加密的数据需要用 k2 才能解密。而此时， k2 在你自己的手里。 k1 送达目的地后，目的地的人会去准备一个接下来用于对称加密传输的密钥 key，然后用收到的 k1 把 key 加密了，把加密好的数据传回来。路上的人就算截取到了，也解密不出 key 。等到了你自己手上，你用手上的 k2 把用 k1 加密的 key 解出来。这样就能保证只有发送方和接收方知道堆成加密的秘钥 key 了。

#### 为什么不用非对称加密直接加密数据？

因为非对称加密对生成和加密的消耗时间比较长，为了节省双方的计算时间，通常只用它来交换密钥，而非直接用来传输数据。

### 非对称加密的隐患
非对称加密其实存在一个隐患，那就是存在"中间人攻击"。为了简化这一过程，我们把发送端、中间人、接收端依次设为 A 、 M 、 B 。 A 和 B 进行秘钥交换的时候，经过了中间人 M 。 M 知道要进行秘钥交换，于是将数据扣下。对于 A ，自己伪造了一个对称秘钥 key ，将 A 发来对 k1 进行加密，发还给了 A 。对于 B ， M 模拟 A 的做法，用非对称加密算法生成了一个 k1 ，发送给了 B ，代替 A 与 B 完成了通信。这样一来， M 就知道 A 和 B 传输的所有数据了。

## HTTPS

### HTTPS 是如何解决非对称加密的隐患的？
这里引入一个叫 CA 的东西。它是一些非常权威的专门用于认证一个网站合法性的组织。服务商可以向他们申请一个证书，使得他们建立安全连接时可以带上 CA 的签名。而 CA 的安全性由操作系统或浏览器来认证。你的 Windows 、 Mac 、 Linux 、 Chrome 、 Safari 等会在安装时带上一个他们认为安全的 CA 证书列表。如果和你建立安全连接的人带着这些人的签名，那么认为这个安全连接是安全的，没有遭到中间人攻击。
但世界上没有绝对的安全，一旦 CA 证书出了问题，就容易被用来进行攻击，因此还是存在安全隐患。但是这已经算是较安全的做法，相信今后还会有更先进的做法来解决这个问题。

## 参考链接
[ HTTP 协议详解](https://www.cnblogs.com/rayray/p/3729533.html)
[ HTTPS 是如何保证安全的？](https://www.jianshu.com/p/b894a7e1c779)
[移动 APP 网络优化概述](http://blog.cnbang.net/tech/3531/)
